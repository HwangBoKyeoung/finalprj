<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.third.prj.deleterequest.mapper.DeleteRequestMapper">
	
	
	<resultMap type="com.third.prj.deleterequest.service.DeleteRequestVO" id="delrequestMap">
		<result column="DEL_REQ_NO" property="delReqNo"/>
		<result column="DELDT" property="delDt"/>
		<result column="C_ID" property="CId"/>
		<result column="DELETE_CD" property="deleteCd"/>
		<result column="MV_NO" property="mvNo"/>
		<result column="P_NO" property="PNo"/>		
		<collection property="performanceVO" resultMap="performanceMap"></collection>
		<collection property="movieVO" resultMap="movieMap"></collection>
	</resultMap>
	
	<resultMap type="com.third.prj.performance.service.PerformanceVO" id="performanceMap">
		<result column="P_NO" property="PNo"/>
		<result column="NAME" property="name"/>
		<result column="CONTENT" property="content" />
		<result column="C_ID" property="CId"/>
		<result column="ACTOR" property="actor"/>
		<result column="FILE_CD" property="fileCd"/>
		<result column="LOC" property="loc"/>
		<result column="ADDR" property="addr"/>
		<result column="PRICE" property="price"/>
	</resultMap>
	<resultMap type="com.third.prj.movie.service.MovieVO" id="movieMap">
		<result column="MV_NO" property="mvNo"/>
		<result column="NAME" property="name"/>
		<result column="GENRE" property="startDate"/>
		<result column="DIRECTOR" property="director"/>
		<result column="RATING" property="rating"/>
		<result column="DISTRIBUTOR" property="distibutor"/>
		<result column="COUNTRY" property="country"/>
		<result column="RUNTIME" property="runtime"/>
		<result column="CONTENT" property="content"/>
		<result column="C_ID" property="CId"/>
		<result column="ACTOR" property="actor"/>
		<result column="FILE_CD" property="fileCd"/>
		<result column="DOCID" property="docId"/>
	</resultMap>
	
	<select id="getTotal" resultType="int">
		SELECT COUNT(*)
		FROM DELETE_REQUEST
		WHERE
		<if test="searchType == 'ALL'">(CONTENT LIKE '%'||#{searchName}||'%'
			OR C_ID LIKE '%'||#{searchName}||'%')</if>
		<if test="searchType == 'CONTENT'">CONTENT LIKE '%'||#{searchName}||'%'</if>
		<if test="searchType == 'C_ID'">C_ID LIKE '%'||#{searchName}||'%'</if>
		<if test="searchType == null or searchType ==''"> 1 = 1</if>
	</select>
	<select id="deleteRequestList" resultType="com.third.prj.deleterequest.service.DeleteRequestVO">
		<![CDATA[
		SELECT DEL_REQ_NO, DELDT, C_ID, DELETE_CD, CONTENT, MV_NO, P_NO
		FROM 
			(
			SELECT ROWNUM RN, A.*
			FROM (
			SELECT DEL_REQ_NO, DELDT, C_ID, DELETE_CD, CONTENT, MV_NO, P_NO
			FROM DELETE_REQUEST
			WHERE
			]]>
			<if test="searchType == 'ALL'">(CONTENT LIKE '%'||#{searchName}||'%'
			OR C_ID LIKE '%'||#{searchName}||'%')</if>
		<if test="searchType == 'CONTENT'">CONTENT LIKE '%'||#{searchName}||'%'</if>
		<if test="searchType == 'C_ID'">C_ID LIKE '%'||#{searchName}||'%'</if>
		<if test="searchType == null or searchType ==''"> 1 = 1</if>
		<![CDATA[
			ORDER BY DEL_REQ_NO
			)A)
		WHERE rn BETWEEN (#{pageNum} -1) *#{amount} AND #{pageNum} * #{amount}
		]]>
	</select>
	
	<select id="deleteRequestSelect" resultType="com.third.prj.deleterequest.service.DeleteRequestVO">
		SELECT DEL_REQ_NO, DELDT, C_ID, DELETE_CD, CONTENT, MV_NO, P_NO
		FROM DELETE_REQUEST
		WHERE DEL_REQ_NO = #{delReqNo} 
	</select>
	
	
	
	<insert id="deletePerforInsert" parameterType="com.third.prj.deleterequest.service.DeleteRequestVO">
		<selectKey keyProperty="delReqNo" resultType="int" order="BEFORE">
			SELECT NVL(MAX(DEL_REQ_NO),0)+1
			FROM DELETE_REQUEST
		</selectKey>
		INSERT INTO DELETE_REQUEST(DEL_REQ_NO,DELDT,DELETE_CD,CONTENT,P_NO,C_ID)
		VALUES(#{delReqNo},#{delDt},#{deleteCd},#{content},#{PNo},#{CId})		
	</insert>
	
	
	
	
	<update id="deleteRequestUpdate" parameterType="com.third.prj.deleterequest.service.DeleteRequestVO">
		UPDATE DELETE_REQUEST
		<set>
			<if test="deleteCd != null">DELETE_CD = #{deleteCd},</if>
		</set>
		WHERE DEL_REQ_NO = #{delReqNo}
	</update>
	
	
	<select id="deleteRequestPerforSelect" resultMap="delrequestMap">
		SELECT D.DEL_REQ_NO,D.DELDT,D.DELETE_CD,D.CONTENT,P.NAME,P.CONTENT,P.ACTOR,D.P_NO,D.C_ID
		FROM DELETE_REQUEST D,PERFORMANCE P
		WHERE P.P_NO=D.P_NO
		AND D.DEL_REQ_NO=#{delReqNo}
	</select>
	<select id="deleteRequestMovieSelect" resultMap="delrequestMap">
		SELECT D.DEL_REQ_NO,D.DELDT,D.DELETE_CD,D.CONTENT,M.NAME,M.CONTENT,M.ACTOR,M.MV_NO,D.C_ID
		FROM DELETE_REQUEST D,MOVIE M
		WHERE M.MV_NO=D.MV_NO
		AND D.DEL_REQ_NO=#{delReqNo}
	</select>
	
	<insert id="deleteMovieInsert" parameterType="com.third.prj.deleterequest.service.DeleteRequestVO">
		<selectKey keyProperty="delReqNo" resultType="int" order="BEFORE">
			SELECT NVL(MAX(DEL_REQ_NO),0)+1
			FROM DELETE_REQUEST
		</selectKey>
		INSERT INTO DELETE_REQUEST(DEL_REQ_NO,DELDT,DELETE_CD,CONTENT,MV_NO,C_ID)
		VALUES(#{delReqNo},#{delDt},#{deleteCd},#{content},#{mvNo},#{CId})		
	</insert>
	
<!-- 	<select id="companyMyDeletePerforList" resultMap="delrequestMap"> -->
<!-- 	<![CDATA[ -->
<!-- 		SELECT M.NAME, M.ACTOR, D.CONTENT, D.DELETE_CD -->
<!-- 		FROM ( -->
<!-- 		SELECT M.NAME, M.ACTOR, D.CONTENT, D.DELETE_CD -->
<!-- 		FROM MOVIE M, DELETE_REQUEST D -->
<!-- 		WHERE M.C_ID = #{CId} -->
<!-- 		AND ]]> -->
<!-- 		<if test="searchType == 'ALL'">(NAME LIKE '%'||#{searchName}||'%' -->
<!-- 			OR DELETE_CD LIKE '%'||#{searchName}||'%')</if> -->
<!-- 		<if test="searchType == 'NAME'">M.NAME LIKE '%'||#{searchName}||'%'</if> -->
<!-- 		<if test="searchType == 'DELETE_CD'">DELETE_CD LIKE '%'||#{searchName}||'%'</if> -->
<!-- 		<if test="searchType == null or searchType ==''"> 1 = 1</if> -->
<!-- 		<![CDATA[ -->
<!-- 		ORDER BY M.NAME )A) -->
<!-- 		WHERE rn BETWEEN (#{pageNum} -1) *#{amount} AND #{pageNum} * #{amount} -->
<!-- 		]]> -->
<!-- 	</select> -->
	
<!-- 	<select id="companyMyDeletePerforList" resultMap="delrequestMap"> -->
<!-- 	<![CDATA[ -->
<!-- 		SELECT P.NAME, P.ACTOR, D.CONTENT, D.DELETE_CD -->
<!-- 		FROM PERFORMANCE P, DELETE_REQUEST D -->
<!-- 		WHERE P.C_ID = #{CId} -->
<!-- 		AND ]]> -->
<!-- 		<if test="searchType == 'ALL'">(NAME LIKE '%'||#{searchName}||'%' -->
<!-- 			OR DELETE_CD LIKE '%'||#{searchName}||'%')</if> -->
<!-- 		<if test="searchType == 'NAME'">NAME LIKE '%'||#{searchName}||'%'</if> -->
<!-- 		<if test="searchType == 'DELETE_CD'">DELETE_CD LIKE '%'||#{searchName}||'%'</if> -->
<!-- 		<if test="searchType == null or searchType ==''"> 1 = 1</if> -->
<!-- 		<![CDATA[ -->
<!-- 		ORDER BY P.NAME )A) -->
<!-- 		WHERE rn BETWEEN (#{pageNum} -1) *#{amount} AND #{pageNum} * #{amount} -->
<!-- 		]]> -->
<!-- 	</select> -->
	
</mapper>