<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.third.prj.inquiry.mapper.InquiryMapper">
	<resultMap type="com.third.prj.inquiry.service.InquiryVO" id="inquiryResultMap">
		<id property="inNo" column="in_no" />
		<result property="title" column="title" />
		<result property="content" column="content" />
		<result property="inDt" column="indt" />
		<result property="uId" column="u_id" />
	</resultMap>

	<select id="getTotal" resultType="int">
		SELECT COUNT(*)
		FROM INQUIRY
		WHERE
		<if test="searchType == 'ALL'">(TITLE LIKE '%'||#{searchName}||'%'
				OR U_ID LIKE '%'||#{searchName}||'%')</if>
			<if test="searchType == 'TITLE'">TITLE LIKE '%'||#{searchName}||'%'</if>
			<if test="searchType == 'U_ID'">U_ID LIKE '%'||#{searchName}||'%'</if>
			<if test="searchType == null or searchType ==''"> 1 = 1</if>
	</select>
	
	<select id="manaerInquiryList" resultType="com.third.prj.inquiry.service.InquiryVO">
		<![CDATA[
		SELECT IN_NO,TITLE,CONTENT,INDT,U_ID
		FROM
			(
			SELECT ROWNUM RN, A.*
			FROM (
			SELECT IN_NO,TITLE,CONTENT,INDT,U_ID
			FROM INQUIRY
			WHERE
			]]>
			<if test="searchType == 'ALL'">(TITLE LIKE '%'||#{searchName}||'%'
				OR U_ID LIKE '%'||#{searchName}||'%')</if>
			<if test="searchType == 'TITLE'">TITLE LIKE '%'||#{searchName}||'%'</if>
			<if test="searchType == 'U_ID'">U_ID LIKE '%'||#{searchName}||'%'</if>
			<if test="searchType == null or searchType ==''"> 1 = 1</if>
			<![CDATA[
			ORDER BY IN_NO )A)
		WHERE rn BETWEEN (#{pageNum} -1) *#{amount} AND #{pageNum} * #{amount}
		]]>
	</select>
	
	<select id="inquirySelectList" resultType="com.third.prj.inquiry.service.InquiryVO">
		SELECT IN_NO,TITLE,CONTENT,INDT,U_ID
		FROM INQUIRY
		ORDER BY INDT DESC
	</select>
	
	<select id="inquirySelect" resultType="com.third.prj.inquiry.service.InquiryVO">
		SELECT IN_NO,TITLE,CONTENT,INDT,U_ID 
		FROM INQUIRY
		WHERE IN_NO=#{inNo}
	</select>
	

	<!-- 1:1문의 -->
	<insert id="inquiryInsert" parameterType="com.third.prj.inquiry.service.InquiryVO">
		<selectKey keyProperty="inNo" resultType="int" order="BEFORE">
			SELECT NVL(MAX(IN_NO),0)+1 AS INNO 
			FROM INQUIRY
		</selectKey>
		INSERT INTO INQUIRY(IN_NO
						  , INDT
						  , TITLE
						  , CONTENT
						  , U_ID)
		VALUES(#{inNo}
			 , #{inDt}
			 , #{title}
		     , #{content}
		     , #{UId})
	</insert>
	
	<update id="inquiryUpdate" parameterType="com.third.prj.inquiry.service.InquiryVO">
		UPDATE INQUIRY
		<set>
			<if test="title != null"> TITLE = #{title},</if>
			<if test="content != null"> CONTENT = #{content},</if>
		</set>
		WHERE IN_NO = #{inNo}
	</update>

	<delete id="inquiryDelete" parameterType="com.third.prj.inquiry.service.InquiryVO">
		DELETE FROM INQUIRY 
		WHERE IN_NO = #{inNo}
	</delete>
	
</mapper>