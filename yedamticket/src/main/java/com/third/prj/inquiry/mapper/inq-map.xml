<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.third.prj.inquiry.mapper.InquiryMapper">

	<resultMap type="com.third.prj.inquiry.service.InquiryVO"
		id="inquiryResultMap">
		<id property="inNo" column="in_no" /><!-- primary key -->
		<result property="title" column="title" />
		<result property="content" column="content" />
		<result property="inDt" column="indt" />
		<result property="uId" column="u_id" />
	</resultMap>


	<select id="inquirySelectList"
		resultType="com.third.prj.inquiry.service.InquiryVO">
		SELECT * FROM INQUIRY
		ORDER BY IN_NO DESC
	</select>
	<select id="inquirySelect"
		resultType="com.third.prj.inquiry.service.InquiryVO">
		SELECT * FROM INQUIRY
		WHERE IN_NO = #{inNo}
	</select>

	<!-- 1:1문의 -->

	<insert id="inquiryInsert"
		parameterType="com.third.prj.inquiry.service.InquiryVO">
		<selectKey keyProperty="inNo" resultType="int" order="BEFORE">
			SELECT MAX(IN_NO)+1 AS INNO FROM INQUIRY
		</selectKey>
		INSERT INTO INQUIRY(IN_NO, TITLE, CONTENT, U_ID)
		VALUES(#{inNo}, #{title}, #{content}, #{UId})
	</insert>
	

	<update id="inquiryUpdate"
		parameterType="com.third.prj.inquiry.service.InquiryVO">
		UPDATE INQUIRY
		<set>
			<if test="title != null"> TITLE = #{title},</if>
			<if test="content != null"> CONTENT = #{content},</if>
		</set>
		WHERE IN_NO = #{inNo}
	</update>

	<delete id="inquiryDelete"
		parameterType="com.third.prj.inquiry.service.InquiryVO">
		DELETE FROM INQUIRY WHERE IN_NO = #{inNo}
	</delete>
	
	<update id="replyupdate" parameterType="com.third.prj.inquiry.service.InquiryVO">
		<![CDATA[
		UPDATE INQUIRY
		SET STEP = STEP +1
		WHERE REFER = (SELECT REFER FROM INQUIRY WHERE INNO = #{inNo})
		AND STEP > (SELECT STEP FROM INQUIRY WHERE INNO = #{inNo})
		]]>
	</update>
	
	<insert id = "replyInsert" parameterType="com.third.prj.inquiry.service.InquiryVO">
		INSERT INTO INQUIRY
		VALUES (INQUIRY_SEQ.NEXTVAL,#{title},#{content},#{inDt},#{uId}
		,(SELECT REFER FROM INQUIRY WHERE INNO=#{inNo})
		,(SELECT STEP FROM INQUIRY WHERE INNO=#{inNo})+1	
		,(SELECT DEPTH FROM INQUIRY WHERE INNO=#{inNo})+1)
	</insert>


</mapper>